<div class="h-full w-full flex flex-col">
  <div class="p-2 text-center bg-white shadow-sm z-10 sticky top-0 flex justify-between items-center">
    <button class="text-sm bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded" hx-get="/partials/splash.html"
      hx-target="#app-content" hx-push-url="?view=splash" hx-swap="innerHTML">
      Back
    </button>
    <div class="font-mono text-sm">Seed: {{ seed }}</div>
  </div>

  <div id="coop-container" class="flex-grow w-full overflow-hidden flex flex-col items-center bg-slate-100 p-4 fade-in">
    <!-- Mission Card -->
    <div class="card flex flex-col items-center bg-white p-6 rounded shadow-lg max-w-md w-full">
      <div class="text-xl font-bold mb-2 text-center">{{ mission.name }}</div>
      <div class="text-md mb-2 text-center">{{ mission.description }}</div>

      {% if !mission.details.is_empty() %}
      <div class="text-left mt-2 w-full">
        <h3 class="text-sm font-semibold text-gray-600">Details</h3>
        <ul class="list-disc pl-5 text-sm">
          {% for detail in mission.details %}
          <li>{{ detail }}</li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      <div class="w-full mt-4">
        {% if let Some(img) = random_item_img %}
        <div class="p-2 flex justify-center">
          <img src="{{ img }}" class="object-contain w-32 h-32" alt="Random Item">
        </div>
        {% endif %}

        {% if let Some(loadout) = random_loadout %}
        <div class="flex flex-wrap justify-center gap-2 mt-2">
          <div class="flex flex-col items-center">
            <img src="{{ loadout.char_img }}" class="w-24 h-24 object-scale-down">
            <span class="text-xs">{{ loadout.char_name }}</span>
          </div>
          <div class="flex flex-col items-center">
            <img src="{{ loadout.kart_img }}" class="w-24 h-24 object-scale-down">
            <span class="text-xs">{{ loadout.kart_name }}</span>
          </div>
          <div class="flex flex-col items-center">
            <img src="{{ loadout.wheel_img }}" class="w-24 h-24 object-scale-down">
            <span class="text-xs">{{ loadout.wheel_name }}</span>
          </div>
          <div class="flex flex-col items-center">
            <img src="{{ loadout.glider_img }}" class="w-24 h-24 object-scale-down">
            <span class="text-xs">{{ loadout.glider_name }}</span>
          </div>
        </div>
        {% endif %}

        {% if let Some(num) = random_number %}
        <div class="text-4xl font-bold p-4 text-center">{{ num }}</div>
        {% endif %}

        {% if let Some(nested) = nested_mission %}
        <div class="mt-4 border-t pt-4 w-full">
          <h4 class="font-bold text-red-600">Single Race Mission:</h4>
          <div class="card flex flex-col items-center border border-gray-200 p-2 rounded mt-2">
            <div class="font-bold">{{ nested.name }}</div>
            <div class="text-sm">{{ nested.description }}</div>

            {% if let Some(items) = nested_gacha_items %}
            <div class="flex flex-wrap justify-center gap-1 mt-2">
              {% for item_img in items %}
              <img src="{{ item_img }}" class="w-12 h-12 object-contain" alt="Gacha Item">
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- 3D Dice Reroll -->
  <div class="py-4 bg-white flex justify-center shadow-[0_-2px_4px_rgba(0,0,0,0.1)]">
    <!-- 
      Clicking the dice requests the SAME URL (reload) but with no seed (so it generates new one) 
      OR strictly we want a new random one. 
      The backend creates a new seed if none provided.
      BUT invalidating the seed in the URL from HTMX is tricky if we just use hx-get="".
      We'll use hx-get="/partials/coop.html" (no params) to force new seed generation if our backend logic handles it.
      Actually, if we just call /partials/coop.html without seed param, backend generates one.
    -->
    <div class="scene js-dice-scene" title="Reroll" hx-get="/partials/coop.html" hx-target="#app-content"
      hx-swap="innerHTML transition:true" onclick="spinDice()">
      <div class="cube js-dice-cube">
        <!-- 1 (Front) -->
        <div class="cube__face cube__face--front face-1">
          <div class="pip"></div>
        </div>
        <!-- 6 (Back) -->
        <div class="cube__face cube__face--back face-6">
          <div class="pip"></div>
          <div class="pip"></div>
          <div class="pip"></div>
          <div class="pip"></div>
          <div class="pip"></div>
          <div class="pip"></div>
        </div>
        <!-- 3 (Right) -->
        <div class="cube__face cube__face--right face-3">
          <div class="pip"></div>
          <div class="pip"></div>
          <div class="pip"></div>
        </div>
        <!-- 4 (Left) -->
        <div class="cube__face cube__face--left face-4">
          <div class="pip"></div>
          <div class="pip"></div>
          <div class="pip"></div>
          <div class="pip"></div>
        </div>
        <!-- 5 (Top) -->
        <div class="cube__face cube__face--top face-5">
          <div class="pip"></div>
          <div class="pip"></div>
          <div class="pip"></div>
          <div class="pip"></div>
          <div class="pip"></div>
        </div>
        <!-- 2 (Bottom) -->
        <div class="cube__face cube__face--bottom face-2">
          <div class="pip"></div>
          <div class="pip"></div>
        </div>
      </div>
    </div>
  </div>
</div>